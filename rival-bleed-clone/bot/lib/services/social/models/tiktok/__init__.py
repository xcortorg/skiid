from http.cookiejar import MozillaCookieJar
from typing import Literal, Optional

from aiohttp import ClientSession as _ClientSession
from pydantic import BaseModel

jar = MozillaCookieJar()
jar.load("tt_cookies.txt")

cookies = [{"domain":".tiktok.com","expirationDate":1738098017.516302,"hostOnly":False,"httpOnly":True,"name":"tt_chain_token","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"m5jYQ89xM3ePpFLMe4IyUQ=="},{"domain":".tiktok.com","expirationDate":1732930698.930293,"hostOnly":False,"httpOnly":True,"name":"store-country-code-src","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"uid"},{"domain":".tiktok.com","expirationDate":1724440314.523083,"hostOnly":False,"httpOnly":False,"name":"_ttp","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"2cs7DhHuJ5D8Qz0S8xBuWykyCIh"},{"domain":".tiktok.com","expirationDate":1732930699.163801,"hostOnly":False,"httpOnly":True,"name":"uid_tt","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"6b3f9b323950d267e24baa5822896daae34889ac41f5aa5b95423c8b3ad3658b"},{"domain":".tiktok.com","expirationDate":1732930699.163834,"hostOnly":False,"httpOnly":True,"name":"uid_tt_ss","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"6b3f9b323950d267e24baa5822896daae34889ac41f5aa5b95423c8b3ad3658b"},{"domain":".tiktok.com","expirationDate":1732930699.163864,"hostOnly":False,"httpOnly":True,"name":"sid_tt","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"b79892f106ff9e2ad326d5ee5083fcad"},{"domain":".tiktok.com","expirationDate":1732930699.163891,"hostOnly":False,"httpOnly":True,"name":"sessionid","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"b79892f106ff9e2ad326d5ee5083fcad"},{"domain":".tiktok.com","expirationDate":1732930699.163924,"hostOnly":False,"httpOnly":True,"name":"sessionid_ss","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"b79892f106ff9e2ad326d5ee5083fcad"},{"domain":".tiktok.com","expirationDate":1732930698.930163,"hostOnly":False,"httpOnly":True,"name":"store-idc","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"useast5"},{"domain":".tiktok.com","expirationDate":1732930698.930262,"hostOnly":False,"httpOnly":True,"name":"store-country-code","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"us"},{"domain":".tiktok.com","expirationDate":1732930698.930322,"hostOnly":False,"httpOnly":True,"name":"tt-target-idc","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"useast8"},{"domain":".tiktok.com","expirationDate":1726018371.054046,"hostOnly":False,"httpOnly":True,"name":"tt-target-idc-sign","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2HFYbn_hYUvxj27ZxRiDqyiaVH4xDl_dWnFuVkvh35yKNexADjDfuSHguQ6qx1UZRTnQeaQ1vfxZeR5ET37g0GH__Cdmy0vnzJhK_pIVfErIM7vABTbP-s5e2yfkC1OFQL8w5ay22lHVUX6DMc6NK01GPOkHTbeB5Y8nK4U5L02OSgg5_4O1HKu7OO7KO-NQrVJhfmJg9cS5zpaKNvsnWBdhv8TUZg6yxg8NHH50GbBlYMNfx7Rkki-zctvI1IGfEllKxeC477hLicluO9Lmlb1QfxBTKb7BCCLX7t8cYWgF2t03YVqjx9ac_aBYHLjIu-G0zycjcyFEGz04UY2YIcTO5t1t7-9ZyyckQpVW-2ov_GbcpmPL0rdRDRZqueJrzNm-TiY8aFyIjN_vv-xL5wykHxZtTjAYRebiwy1LeJxOR2I_NPCNDw5La39X7XlR0lh9AP1q_n_t6lzBORqG1w2J5aUitR2gMZ-9quHB12ak6OJe5nFzn5EcyPSztjHo"},{"domain":".tiktok.com","expirationDate":1732930699.163714,"hostOnly":False,"httpOnly":True,"name":"sid_guard","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"b79892f106ff9e2ad326d5ee5083fcad%7C1717378698%7C15552000%7CSat%2C+30-Nov-2024+01%3A38%3A18+GMT"},{"domain":".tiktok.com","expirationDate":1732930699.163951,"hostOnly":False,"httpOnly":True,"name":"sid_ucp_v1","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"1.0.0-KDk0YmRmN2M0MmJmMTgyNjdhM2Q3ZmU1ZTlmNDczZmQ4ZmExOTk1N2YKIAiriNzKyuji7WUQir30sgYYswsgDDD5lu6uBjgBQOsHEAQaB3VzZWFzdDgiIGI3OTg5MmYxMDZmZjllMmFkMzI2ZDVlZTUwODNmY2Fk"},{"domain":".tiktok.com","expirationDate":1732930699.163979,"hostOnly":False,"httpOnly":True,"name":"ssid_ucp_v1","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"1.0.0-KDk0YmRmN2M0MmJmMTgyNjdhM2Q3ZmU1ZTlmNDczZmQ4ZmExOTk1N2YKIAiriNzKyuji7WUQir30sgYYswsgDDD5lu6uBjgBQOsHEAQaB3VzZWFzdDgiIGI3OTg5MmYxMDZmZjllMmFkMzI2ZDVlZTUwODNmY2Fk"},{"domain":".tiktok.com","hostOnly":False,"httpOnly":True,"name":"tt_csrf_token","path":"/","sameSite":"lax","secure":True,"session":True,"storeId":"0","value":"aC0SBwKz-WL2cEbzUrReS3aOssvI4Nnt7XuU"},{"domain":".tiktok.com","expirationDate":1722552309.661322,"hostOnly":False,"httpOnly":False,"name":"ak_bmsc","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"9257BDC531C7F0480D23F7EBB26F794F~000000000000000000000000000000~YAAQDRICF4TVHwmRAQAABXqwDxhxp1YlZNPcZQSm3NUcxEbHH3bdX+qjO1giuPrakKXQGh/wTLv25hV0Lq8QXf+69QJYRKKdqSsaH+uBPpU7XkVCGB0sSBHJiw+dzsr3lWMLFfwYSO8gnsx5gRX3f8Cu2O+JSYIiOKvYGrS8m5FlaxE5NwyCmmuSA5JL9RT5evoK3N2yT7FQxF6NcbmwgFhd+Ne2RJjXM1BmsDeRA0/px4WVJIdnulEM6X0K1C5yM81QlSLvGUxVfSpFXMIrRe9K+KMDoW077qX2j9PCqMzQpnrpnHInneU0Zp4mW6h2qtm/IFtVuSmhHZLBpuha0gqDE927yOYkDjjues2jaFCnR1eesdYIlbkMRVReDsMiWHRyQM+C7AsG8Fw="},{"domain":".www.tiktok.com","expirationDate":1723149910.497151,"hostOnly":False,"httpOnly":False,"name":"tiktok_webapp_theme_auto_dark_ab","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"1"},{"domain":".www.tiktok.com","expirationDate":1723149910.497333,"hostOnly":False,"httpOnly":False,"name":"tiktok_webapp_theme_source","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"system"},{"domain":".www.tiktok.com","expirationDate":1723150818.273463,"hostOnly":False,"httpOnly":False,"name":"tiktok_webapp_theme","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"dark"},{"domain":".www.tiktok.com","expirationDate":1723149914.568291,"hostOnly":False,"httpOnly":False,"name":"delay_guest_mode_vid","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"10"},{"domain":".tiktok.com","expirationDate":1722552317.516414,"hostOnly":False,"httpOnly":False,"name":"bm_sv","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"6EB7CB31E2E4A307220A637569D01681~YAAQGRICF3+1EAmRAQAAVlS+DxgKWM0j2sgsX+jSJW7VSnwS+lks5MtWvRFraiPPEaEHEpUwxmiSeP4y/YM3Y03vCESikPQ3MdNQP3vqg7WnjGvOLefzMxsvoJ/PlCPdqJoMW/ByC79lElJ1aVSQth6nVQHqMxnRBBgikkCJko94xGHBNJ33nezi1kFxGSlaqWSYBP1WZIMWN7NXVE3LRNFNnR0d25iMNTuwcrKXFa3A/LDzmioABvrVpiNN6qDX~1"},{"domain":".www.tiktok.com","hostOnly":False,"httpOnly":False,"name":"passport_fe_beating_status","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"True"},{"domain":".tiktok.com","expirationDate":1738098019.787956,"hostOnly":False,"httpOnly":True,"name":"ttwid","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"1%7CAyzrHmzafWM6Tfz5CSF-RlsZBrY-Dnfu7jieE0I8mck%7C1722546019%7Ca7f8b3991c19478fb9b51c1c84f6adc6cd193bc181f110ca20c9998b103ce70f"},{"domain":"www.tiktok.com","expirationDate":1723150821.861673,"hostOnly":True,"httpOnly":False,"name":"msToken","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"K2uEWLLGz9i6B77WAvN5xZ31-NlTOlhCeEqfELnYyJHTAH3iKhuqaRMKntgYemDA1D8X0rtBZYhUc8qHHsihoWqnpzPFA7PbuXu77Sz7Eyf4zEE-4xJ3UyzIBQJfbFgVo3VVKzPn1ZmnHhjCwLlE_WE="},{"domain":".tiktok.com","expirationDate":1723410021.238396,"hostOnly":False,"httpOnly":False,"name":"msToken","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"aR63ebQZ5G4Ba77hgB72jSpxzfZ7TLdzr6gf1fB6ooaeAfot0h1eX_s9vjzR_md3FRKmr6nHiJT7hZADQM2nO0j5LyXGPQpFCPI507llsQNkGGnpN4vUnZrHirXbYyKv5h3ry35gFWbzhxe2eDEUhMk="},{"domain":".www.tiktok.com","expirationDate":1722978023,"hostOnly":False,"httpOnly":False,"name":"perf_feed_cache","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"{%22expireTimestamp%22:1722718800000%2C%22itemIds%22:[%227365596158149856545%22%2C%227393123068371242286%22%2C%227389747145307393322%22]}"},{"domain":".tiktok.com","expirationDate":1738098620.522223,"hostOnly":False,"httpOnly":True,"name":"odin_tt","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"ac56ceeb039f4d0446dc87dafb0ea9de0793b66bf928b32406ff1d99b59720ea592c21bced48420fb1f41eb4d3dae2a44e55a10bf9c3954f6455d3cf211af4d2"}]
{"domain":".tiktok.com","expirationDate":1738098620.522223,"hostOnly":False,"httpOnly":True,"name":"odin_tt","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"ac56ceeb039f4d0446dc87dafb0ea9de0793b66bf928b32406ff1d99b59720ea592c21bced48420fb1f41eb4d3dae2a44e55a10bf9c3954f6455d3cf211af4d2"}


class ClientSession(_ClientSession):
    msToken: Optional[str] = None

    def __init__(self, *args, **kwargs):
        for cookie in jar:
            if cookie.name == "msToken":
                self.msToken = cookie.value
                break

        super().__init__(
            *args,
            cookies={cookie["name"]: cookie["value"] for cookie in cookies},
            **kwargs,
        )
        self.headers.update(
            {
                "User-Agent": (
                    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "
                    "(KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"
                ),
                "msToken": self.msToken or "",
            }
        )
